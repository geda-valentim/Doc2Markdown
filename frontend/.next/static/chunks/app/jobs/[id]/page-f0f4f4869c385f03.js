(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{2603:(e,t,s)=>{Promise.resolve().then(s.bind(s,3713))},3713:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>F});var a=s(5155),l=s(2115),d=s(63),r=s(9776),n=s(2454),i=s(549),c=s(1362),o=s(8874),u=s(5299),m=s(6983),x=s(5626),h=s(1360),p=s(1847);let g=(0,p.A)("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);var j=s(9715);let f=(0,p.A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var v=s(7621),b=s(5895),N=s(7003),y=s(3209),w=s(120),k=s(3630),C=s(5229),A=s(5016);let R=k.bL;k.l9;let _=k.ZL;k.bm;let P=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(k.hJ,{ref:t,className:(0,A.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...l})});P.displayName=k.hJ.displayName;let B=l.forwardRef((e,t)=>{let{className:s,children:l,...d}=e;return(0,a.jsxs)(_,{children:[(0,a.jsx)(P,{}),(0,a.jsxs)(k.UC,{ref:t,className:(0,A.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...d,children:[l,(0,a.jsxs)(k.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(C.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});B.displayName=k.UC.displayName;let E=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,A.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};E.displayName="DialogHeader";let q=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(k.hE,{ref:t,className:(0,A.cn)("text-lg font-semibold leading-none tracking-tight",s),...l})});q.displayName=k.hE.displayName;let L=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(k.VY,{ref:t,className:(0,A.cn)("text-sm text-muted-foreground",s),...l})});L.displayName=k.VY.displayName;var U=s(7830),D=s(8171);function F(e){var t;let{params:s}=e,p=(0,l.use)(s),k=(0,d.useRouter)(),C=(0,r.jE)(),{toast:A}=(0,D.dj)(),_=(0,b.n)(e=>null!==e.token&&null!==e.user),P=(0,b.n)(e=>e._hasHydrated),[F,S]=(0,l.useState)(!1),[O,I]=(0,l.useState)(!1),[z,M]=(0,l.useState)(null),[J,K]=(0,l.useState)(!1);(0,l.useEffect)(()=>{P&&!_&&k.push("/login")},[_,P,k]);let{data:T,isLoading:Z}=(0,n.I)({queryKey:["job-status",p.id],queryFn:()=>v.Bt.getStatus(p.id),refetchInterval:e=>{var t;let s=null==(t=e.state.data)?void 0:t.status;return"completed"!==s&&"failed"!==s&&3e3}}),{data:$}=(0,n.I)({queryKey:["job-result",p.id],queryFn:()=>v.Bt.getResult(p.id),enabled:(null==T?void 0:T.status)==="completed"&&F}),{data:H}=(0,n.I)({queryKey:["job-pages",p.id],queryFn:()=>v.Bt.getPages(p.id),enabled:(null==T?void 0:T.type)==="main"&&(null!=(t=null==T?void 0:T.total_pages)?t:0)>0,refetchInterval:e=>{let t=e.state.data;return!!t&&t.pages_completed+t.pages_failed<t.total_pages&&3e3}}),{data:Q,isLoading:V}=(0,n.I)({queryKey:["page-result",p.id,z],queryFn:()=>v.Bt.getPageResultByNumber(p.id,z),enabled:null!==z&&J}),W=(0,i.n)({mutationFn:()=>v.Bt.delete(p.id),onSuccess:()=>{C.invalidateQueries({queryKey:["jobs"]}),A({title:"Job deleted",description:"The job has been successfully deleted."}),k.push("/jobs")},onError:e=>{var t,s;A({title:"Error deleting job",description:(null==(s=e.response)||null==(t=s.data)?void 0:t.detail)||"Failed to delete job",variant:"destructive"})}}),Y=(0,i.n)({mutationFn:e=>{let{pageJobId:t}=e;return v.Bt.retryPage(t)},onSuccess:(e,t)=>{C.invalidateQueries({queryKey:["job-status",p.id]}),A({title:"Page retry started",description:"Page is being reprocessed. New job ID: ".concat(e)})},onError:e=>{var t,s;A({title:"Retry failed",description:(null==(s=e.response)||null==(t=s.data)?void 0:t.detail)||"Failed to retry page",variant:"destructive"})}});return Z?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted",children:[(0,a.jsx)("header",{className:"border-b bg-background/95 backdrop-blur",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)(N.$,{variant:"ghost",onClick:()=>k.push("/dashboard"),className:"mb-2",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})})}),(0,a.jsx)("main",{className:"container mx-auto px-4 py-12",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,a.jsxs)(y.Zp,{children:[(0,a.jsx)(y.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(y.ZB,{children:"Job Status"}),(0,a.jsx)(y.BT,{className:"mt-1",children:(null==T?void 0:T.name)||"Job ID: ".concat(p.id)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(()=>{switch(null==T?void 0:T.status){case"completed":return(0,a.jsx)(c.A,{className:"h-12 w-12 text-green-500"});case"failed":return(0,a.jsx)(o.A,{className:"h-12 w-12 text-red-500"});case"processing":return(0,a.jsx)(u.A,{className:"h-12 w-12 text-blue-500 animate-spin"});default:return(0,a.jsx)(m.A,{className:"h-12 w-12 text-yellow-500"})}})(),(0,a.jsx)(N.$,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{I(!0)},children:(0,a.jsx)(h.A,{className:"h-5 w-5"})})]})]})}),(0,a.jsxs)(y.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,a.jsx)("p",{className:"font-medium capitalize ".concat((()=>{switch(null==T?void 0:T.status){case"completed":return"text-green-500";case"failed":return"text-red-500";case"processing":return"text-blue-500";default:return"text-yellow-500"}})()),children:null==T?void 0:T.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Progress"}),(0,a.jsxs)("p",{className:"font-medium",children:[null==T?void 0:T.progress,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Created"}),(0,a.jsx)("p",{className:"font-medium text-sm",children:(null==T?void 0:T.created_at)?(0,U.m)(new Date(T.created_at),{addSuffix:!0}):"-"})]}),(null==T?void 0:T.completed_at)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Completed"}),(0,a.jsx)("p",{className:"font-medium text-sm",children:(0,U.m)(new Date(T.completed_at),{addSuffix:!0})})]})]}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)("div",{className:"w-full bg-secondary rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:"".concat((null==T?void 0:T.progress)||0,"%")}})})}),(null==T?void 0:T.error)&&(0,a.jsxs)("div",{className:"rounded-md bg-destructive/10 border border-destructive/20 p-4 text-sm text-destructive",children:[(0,a.jsx)("p",{className:"font-medium",children:"Error:"}),(0,a.jsx)("p",{className:"mt-1",children:T.error})]}),(null==T?void 0:T.pages)&&T.pages.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Pages Progress"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[T.pages.filter(e=>"completed"===e.status).length," /"," ",T.total_pages," completed",T.pages.filter(e=>"failed"===e.status).length>0&&(0,a.jsxs)("span",{className:"text-destructive ml-2",children:["(",T.pages.filter(e=>"failed"===e.status).length," failed)"]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 gap-2",children:T.pages.map(e=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:t=>{var s,a;return s=e.page_number,a=e.status,void(!t.target.closest("button[data-retry]")&&"completed"===a&&(M(s),K(!0)))},disabled:"completed"!==e.status&&"failed"!==e.status,className:"\n                            relative w-full h-10 sm:h-9 md:h-8 rounded border-2 flex items-center justify-center text-xs font-medium transition-all cursor-pointer hover:scale-105 active:scale-95 disabled:cursor-not-allowed disabled:hover:scale-100\n                            ".concat("completed"===e.status?"bg-green-500/10 border-green-500/50 text-green-700 dark:text-green-400 hover:bg-green-500/20":"failed"===e.status?"bg-red-500/10 border-red-500/50 text-red-700 dark:text-red-400 hover:bg-red-500/20":"processing"===e.status?"bg-blue-500/10 border-blue-500/50 text-blue-700 dark:text-blue-400 animate-pulse":"bg-yellow-500/10 border-yellow-500/50 text-yellow-700 dark:text-yellow-400 hover:bg-yellow-500/20","\n                          "),title:"Page ".concat(e.page_number,": ").concat(e.status).concat("completed"===e.status?" - Click to view":"failed"===e.status?" - Click to retry":""),children:[e.page_number,(0,a.jsxs)("div",{className:"absolute -top-1 -right-1",children:["completed"===e.status&&(0,a.jsx)(c.A,{className:"h-3 w-3 text-green-600 dark:text-green-400"}),"failed"===e.status&&(0,a.jsx)(o.A,{className:"h-3 w-3 text-red-600 dark:text-red-400"}),"processing"===e.status&&(0,a.jsx)(u.A,{className:"h-3 w-3 text-blue-600 dark:text-blue-400 animate-spin"}),"queued"===e.status&&(0,a.jsx)(m.A,{className:"h-3 w-3 text-yellow-600 dark:text-yellow-400"})]})]}),"failed"===e.status&&(0,a.jsx)("button",{"data-retry":!0,onClick:t=>{var s;return s=e.job_id,void(t.stopPropagation(),Y.mutate({pageJobId:s}))},disabled:Y.isPending,className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-destructive hover:bg-destructive/90 text-destructive-foreground rounded-full p-0.5 shadow-sm hover:shadow-md transition-all disabled:opacity-50",title:"Retry this page",children:(0,a.jsx)(g,{className:"h-2.5 w-2.5 ".concat(Y.isPending?"animate-spin":"")})})]},e.page_number))}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 text-xs text-muted-foreground pt-2 border-t",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(c.A,{className:"h-3 w-3 text-green-600 dark:text-green-400"}),(0,a.jsx)("span",{children:"Completed"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(u.A,{className:"h-3 w-3 text-blue-600 dark:text-blue-400"}),(0,a.jsx)("span",{children:"Processing"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(m.A,{className:"h-3 w-3 text-yellow-600 dark:text-yellow-400"}),(0,a.jsx)("span",{children:"Queued"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(o.A,{className:"h-3 w-3 text-red-600 dark:text-red-400"}),(0,a.jsx)("span",{children:"Failed"})]})]})]}),(null==T?void 0:T.status)==="completed"&&(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)(N.$,{onClick:()=>S(!F),className:"flex-1",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-2"}),F?"Hide":"View"," Result"]}),(0,a.jsxs)(N.$,{onClick:()=>{if(!$)return;let e=new Blob([$.result.markdown],{type:"text/markdown"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="".concat((null==T?void 0:T.name)||p.id,".md"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)},variant:"outline",children:[(0,a.jsx)(f,{className:"h-4 w-4 mr-2"}),"Download"]})]})]})]}),F&&$&&(0,a.jsxs)(y.Zp,{children:[(0,a.jsxs)(y.aR,{children:[(0,a.jsx)(y.ZB,{children:"Markdown Output"}),(0,a.jsxs)(y.BT,{children:[$.result.metadata.pages&&"".concat($.result.metadata.pages," pages • "),$.result.metadata.format.toUpperCase()]})]}),(0,a.jsx)(y.Wu,{children:(0,a.jsx)("div",{className:"bg-muted rounded-lg p-4 max-h-[600px] overflow-y-auto",children:(0,a.jsx)("pre",{className:"text-sm whitespace-pre-wrap font-mono",children:$.result.markdown})})})]})]})}),(0,a.jsx)(R,{open:J,onOpenChange:K,children:(0,a.jsxs)(B,{className:"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)(E,{children:[(0,a.jsxs)(q,{children:["Page ",z," - Markdown Result"]}),(0,a.jsx)(L,{children:(null==Q?void 0:Q.result.metadata)&&(0,a.jsxs)("span",{children:[Q.result.metadata.format.toUpperCase()," • Page ",z]})})]}),V?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"})}):Q?(0,a.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col gap-4",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)(N.$,{onClick:()=>{if(!Q)return;let e=new Blob([Q.result.markdown],{type:"text/markdown"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="".concat((null==T?void 0:T.name)||p.id,"-page-").concat(z,".md"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)},size:"sm",variant:"outline",children:[(0,a.jsx)(f,{className:"h-4 w-4 mr-2"}),"Download Page"]})}),(0,a.jsx)("div",{className:"flex-1 bg-muted rounded-lg p-4 overflow-y-auto",children:(0,a.jsx)("pre",{className:"text-sm whitespace-pre-wrap font-mono",children:Q.result.markdown})})]}):(0,a.jsx)("div",{className:"py-12 text-center text-muted-foreground",children:"Failed to load page result"})]})}),(0,a.jsx)(w.Lt,{open:O,onOpenChange:I,children:(0,a.jsxs)(w.EO,{children:[(0,a.jsxs)(w.wd,{children:[(0,a.jsx)(w.r7,{children:"Are you sure?"}),(0,a.jsxs)(w.$v,{children:["This action cannot be undone. This will permanently delete the job and all its associated data including:",(0,a.jsxs)("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[(0,a.jsx)("li",{children:"Job metadata"}),(0,a.jsx)("li",{children:"All pages and content"}),(0,a.jsx)("li",{children:"Markdown content"}),(0,a.jsx)("li",{children:"Temporary processing data"})]})]})]}),(0,a.jsxs)(w.ck,{children:[(0,a.jsx)(w.Zr,{children:"Cancel"}),(0,a.jsx)(w.Rx,{onClick:()=>{W.mutate()},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:W.isPending,children:W.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}},5229:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},e=>{e.O(0,[209,841,476,519,590,441,255,358],()=>e(e.s=2603)),_N_E=e.O()}]);